<div class="p-4 bg-[#fff5f5] min-h-screen">
  <!-- ENCABEZADO -->
  <div class="text-center my-6">
    <h1 class="text-3xl font-bold text-pink-700">MENU PRODUCTOS</h1>
    <p class="text-gray-600">Administra tus productos</p>
  </div>

  <!-- TABLA -->
  <div class="card bg-white shadow-md rounded-2xl p-6">
    <div class="flex justify-between mb-3">
      <h2 class="font-semibold text-lg text-gray-700">Lista de productos</h2>
      <button pButton icon="pi pi-plus" class="p-button-rounded p-button-success" (click)="openNew()"></button>
    </div>

    <p-table [value]="products" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Producto</th>
          <th>Descripción</th>
          <th>Precio</th>
          <th>Tamaño</th>
          <th>Categoría</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product>
        <tr>
          <td class="flex items-center gap-2">
            <img *ngIf="product.image_url" [src]="product.image_url" alt="img" width="60" class="rounded shadow" />
            <span class="font-medium">{{ product.name }}</span>
          </td>
          <td>{{ product.description || '—' }}</td>
          <td>\${{ product.price }}</td>
          <td>{{ product.size }}</td>
          <td>{{ product.category }}</td>
          <td>{{ product.stock }}</td>
          <td class="flex gap-2">
            <button pButton icon="pi pi-pencil" class="p-button-warning p-button-rounded" (click)="editProduct(product)"></button>
            <button pButton icon="pi pi-trash" class="p-button-danger p-button-rounded" (click)="deleteProduct(product.id_product!)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- DIALOGO -->
  <p-dialog [(visible)]="productDialog" [modal]="true" [style]="{ width: '500px' }" header="{{ editMode ? 'Editar Producto' : 'Nuevo Producto' }}">
    <div class="flex flex-col gap-3">
      <div>
        <label>Nombre *</label>
        <input pInputText [(ngModel)]="selectedProduct.name" class="w-full" />
      </div>

      <div>
        <label>Descripción</label>
        <textarea pInputTextarea [(ngModel)]="selectedProduct.description" class="w-full" rows="3"></textarea>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <div>
          <label>Precio *</label>
          <input type="number" pInputText [(ngModel)]="selectedProduct.price" class="w-full" />
        </div>
        <div>
          <label>Tamaño</label>
          <input type="number" pInputText [(ngModel)]="selectedProduct.size" class="w-full" />
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <div>
          <label>Stock *</label>
          <input type="number" pInputText [(ngModel)]="selectedProduct.stock" class="w-full" />
        </div>
        <div>
          <label>Categoría *</label>
          <input pInputText [(ngModel)]="selectedProduct.category" class="w-full" />
        </div>
      </div>

      <!-- Subida de imagen -->
      <div>
        <label>Imagen del producto</label>
        <p-fileupload
          mode="advanced"
          name="file"
          accept="image/*"
          maxFileSize="2000000"
          chooseLabel="Seleccionar"
          uploadLabel="Subir"
          cancelLabel="Cancelar"
          [customUpload]="true"
          (uploadHandler)="uploadImage($event)"
        ></p-fileupload>

        <div *ngIf="uploadedImageUrl" class="mt-3 text-center">
          <img [src]="uploadedImageUrl" alt="Vista previa" class="w-32 h-32 object-cover rounded-lg mx-auto" />
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
      <button pButton label="Guardar" icon="pi pi-check" (click)="saveProduct()"></button>
    </ng-template>
  </p-dialog>
</div>
